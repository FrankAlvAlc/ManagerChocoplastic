(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{28:function(e,t,s){"use strict";s.r(t);var i=s(3),o=s(1),n=s.n(o);function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function c(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var r={data:function(){return{headers:[{text:"ID",value:"id"},{text:"Nombre",value:"name"},{text:"Correo",value:"email"},{text:"Perfil",value:"role.name"},{text:"",value:"action"}],show:!1,users:[],user:[],roles:[],permissions:[],selectedPermissions:[],errors:[],editingText:"",editingMode:!1,action:null,selectedModel:null,selectedRole:null,selectedUser:null,assignRole:!1,dialog:!1,dialogNegocio:!1,snackbar:!1,textMsg:"",timeout:2e3,idAdminBusiness:0,selectStore:0,stores:"",editado:{id:"",name:"",email:"",password:""},editadoTemp:{id:"",name:"",email:"",password:""},editadoDefault:{id:"",name:"",email:"",password:""},editadoBusiness:{id:"",name:"",email:"",password:"",checkB:!1,idBusiness:0},business:[],selectBusiness:""}},created:function(){this.getUser(),this.getUsers(),this.getRoles(),this.getPermissions(),this.getstores()},methods:{abrirdialog:function(){this.editado=this.editadoTemp,this.dialog=!0,this.editado.email="",console.log(this.editado)},getstores:function(){var e=this;axios.get("/storeget").then((function(t){e.stores=t.data.data,console.log(e.stores)})).catch((function(t){e.errors.push(t)}))},getUser:function(){var e=this;axios.get("/listUser").then((function(t){e.user=t.data.data})).catch((function(e){console.log(e)}))},getBusiness:function(e){var t=this;e||(e=0),axios.get("/getBusiness/"+e).then((function(e){t.business=e.data.data,console.log(t.business)})).catch((function(e){console.log(e)}))},changeBusiness:function(e){this.getBusiness(e)},getUserBusiness:function(e){var t=this;axios.get("/usuarioBusiness/"+e).then((function(e){t.idAdminBusiness=e.data.data.store_id,console.log(t.idAdminBusiness),0==t.idAdminBusiness?t.editadoBusiness.checkB=!1:(t.editadoBusiness.checkB=!0,t.selectStore=t.idAdminBusiness),t.dialogNegocio=!0})).catch((function(e){console.log(e)}))},saveUserRole:function(){var e=this;axios.post("/admins/"+this.selectedUser.id+"/role",{role_id:this.selectedRole}).then((function(t){e.users.splice(e.users.indexOf(e.users.find((function(t){return t.id===e.selectedUser.id}))),1,t.data.data),e.assignRole=!1,e.selectedUser=null,e.selectedRole=!1})).catch((function(t){e.errors.push(t)}))},saveUserPermissions:function(){var e=this;axios.post("/admins/"+this.selectedModel.id+"/permissions",this.selectedPermissions).then((function(t){e.users.splice(e.users.indexOf(e.users.find((function(t){return t.id===e.selectedModel.id}))),1,t.data.data)})).catch((function(t){e.errors.push(t)})),this.editingMode=!1},saveRolePermissions:function(){var e=this;axios.post("/roles/"+this.selectedModel.id+"/permissions",this.selectedPermissions).then((function(t){e.roles.splice(e.users.indexOf(e.users.find((function(t){return t.id===e.selectedModel.id}))),1,t.data.data)})).catch((function(t){e.errors.push(t)})),this.editingMode=!1},getUsers:function(){var e=this;axios.get("/users").then((function(t){e.users=t.data.data})).catch((function(t){e.errors.push(t)}))},getRoles:function(){var e=this;axios.get("/roles").then((function(t){e.roles=t.data.data})).catch((function(t){e.errors.push(t)}))},getPermissions:function(){var e=this;axios.get("/permissions").then((function(t){e.permissions=t.data.data})).catch((function(t){e.errors.push(t)}))},cancelar:function(){this.dialog=!1,this.editado=Object.assign({},this.defaultItem),this.editedIndex=-1},guardar:function(){this.editedIndex>-1?(this.textMsg="¡Actualización Exitosa!",this.snackbar=!0,this.editarAdmin()):(this.textMsg="¡Alta exitosa!",this.snackbar=!0,this.addAdmin()),this.cancelar()},editar:function(e){this.editedIndex=this.users.indexOf(e),this.editadoTemp=Object.assign({},e),this.editado.id=this.editadoTemp.id,this.editado.name=this.editadoTemp.name,this.editado.email=this.editadoTemp.email,this.editado.password="",console.log(this.editado),this.dialog=!0},editarNegocio:function(e){this.editedIndex=this.users.indexOf(e),this.editadoTemp=Object.assign({},e),this.getUserBusiness(this.editadoTemp.id),this.editadoBusiness.id=this.editadoTemp.id,this.editadoBusiness.name=this.editadoTemp.name,this.editadoBusiness.email=this.editadoTemp.email,this.editadoBusiness.password=""},cancelarNegocio:function(){this.dialogNegocio=!1,this.editado=Object.assign({},this.defaultItem),this.editedIndex=-1},guardarNegocio:function(){this.editarBusAdmin(),this.cancelarNegocio()},addAdmin:function(){var e=this;axios.post("/admin/add",this.editado).then((function(t){e.getUsers()}))},editarAdmin:function(){var e=this;console.log(this.editado),axios.put("/admin/update",this.editado).then((function(t){e.getUsers()}))},editarBusAdmin:function(){var e=this;this.editadoBusiness.checkB?this.editadoBusiness.idBusiness=this.selectStore.stor_pk:this.editadoBusiness.idBusiness=null,console.log(this.editadoBusiness),axios.put("/admin/updateBusiness",this.editadoBusiness).then((function(t){e.normal("Notificación","¡Actualizado correctamente!","success")}))},normal:function(e,t,s){this.notice=new n.a({title:e,description:t,className:"open-normal",closable:!0,duration:3,type:s})}},computed:function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){c(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({},Object(i.b)("auth",["can"]))},d=s(0),l=Object(d.a)(r,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",[s("v-snackbar",{attrs:{timeout:e.timeout},model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v(e._s(e.textMsg)+"\n"),s("v-btn",{attrs:{color:"blue",text:""},on:{click:function(t){e.snackbar=!1}}},[e._v("Cerrar ")])],1),e._v(" "),s("v-row",[s("v-col",[s("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.users,"item-key":"id"},scopedSlots:e._u([{key:"top",fn:function(){return[s("v-system-bar",{attrs:{color:"indigo darken-2",dark:""}}),e._v(" "),s("v-toolbar",{attrs:{flat:"",color:"indigo"},scopedSlots:e._u([{key:"extension",fn:function(){return[s("v-btn",{attrs:{fab:"",color:"cyan accent-2",bottom:"",left:"",absolute:""},on:{click:function(t){return e.abrirdialog()}}},[s("v-icon",[e._v("mdi-plus")])],1)]},proxy:!0}])},[e._v(" "),s("v-divider",{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),e._v(" "),s("v-spacer")],1)]},proxy:!0},{key:"item.action",fn:function(t){var i=t.item;return[s("v-btn",{attrs:{small:"",icon:"",fab:"",color:"blue",title:"Editar usuario"},on:{click:function(t){return e.editar(i)}}},[s("v-icon",[e._v("mdi-account-edit")])],1),e._v(" "),s("v-btn",{attrs:{small:"",icon:"",fab:"",color:"blue",title:"Editar negocio"},on:{click:function(t){return e.editarNegocio(i)}}},[s("v-icon",[e._v("mdi-store-outline")])],1),e._v(" "),s("v-btn",{attrs:{small:"",icon:"",fab:"",color:"success",title:"Asignar rol"},on:{click:function(t){e.selectedModel=i,e.assignRole=!0,e.selectedUser=i,e.selectedRole=i.role_id}}},[s("v-icon",[e._v("mdi-account-key")])],1),e._v(" "),s("v-btn",{attrs:{small:"",icon:"",fab:"",color:"warning",title:"Editar permisos de usuario"},on:{click:function(t){e.selectedModel=i,e.selectedPermissions=i.permissions.map((function(e){return e.id})),e.editingText=i.name,e.action=e.saveUserPermissions,e.editingMode=!0}}},[s("v-icon",[e._v(" mdi-pencil-lock")])],1),e._v(" "),s("v-btn",{attrs:{small:"",icon:"",fab:"",color:"error",title:"Desactivar usuario"}},[s("v-icon",[e._v("mdi-account-off")])],1)]}}])})],1)],1),e._v(" "),s("v-row",[s("v-col",{attrs:{cols:"6"}},[e.can("role")?s("v-card",[s("v-list",{attrs:{dense:""}},[s("v-list-item-group",{attrs:{color:"info"},model:{value:e.selectedRole,callback:function(t){e.selectedRole=t},expression:"selectedRole"}},[s("v-card-title",[e._v("Roles")]),e._v(" "),e.selectedUser?s("v-card-subtitle",{domProps:{textContent:e._s(e.selectedUser.name)}}):e._e(),e._v(" "),e._l(e.roles,(function(t){return s("v-list-item",{key:t.id,attrs:{"two-line":"",value:t.id},on:{click:function(s){e.selectedModel=t,e.selectedPermissions=t.permissions.map((function(e){return e.id})),e.editingText=t.name,e.editingMode=!1}}},[s("v-list-item-content",[s("v-list-item-title",{domProps:{textContent:e._s(t.name)}}),e._v(" "),s("v-list-item-subtitle",{domProps:{textContent:e._s(t.description)}})],1),e._v(" "),s("v-list-item-icon",[s("v-btn",{attrs:{color:"warning",icon:"",title:"Editar permisos de role"},on:{click:function(s){s.stopPropagation(),e.selectedModel=t,e.selectedPermissions=t.permissions.map((function(e){return e.id})),e.editingText=t.name,e.editingMode=!0,e.action=e.saveRolePermissions}}},[s("v-icon",[e._v("mdi-pencil-lock")])],1),e._v(" "),s("v-btn",{attrs:{color:"error",icon:"",title:"Eliminar role"}},[s("v-icon",[e._v("mdi-delete")])],1)],1)],1)}))],2)],1),e._v(" "),e.assignRole?s("v-card-actions",[s("v-btn",{attrs:{text:"",color:"success"},on:{click:e.saveUserRole}},[e._v("Asignar")]),e._v(" "),s("v-btn",{attrs:{text:"",color:"error"},on:{click:function(t){e.assignRole=!1,e.selectedUser=null}}},[e._v("Cancelar")])],1):e._e()],1):e._e()],1),e._v(" "),s("v-col",[e.can("permission")?s("v-card",[s("v-card-title",[e._v("Permisos")]),e._v(" "),s("v-card-subtitle",{domProps:{textContent:e._s(e.editingText)}}),e._v(" "),s("v-treeview",{attrs:{dense:"",items:e.permissions,"selection-type":"independent",selectable:"","open-on-click":"","open-all":"","item-key":"id","item-text":"name","item-children":"permissions"},model:{value:e.selectedPermissions,callback:function(t){e.selectedPermissions=t},expression:"selectedPermissions"}}),e._v(" "),e.editingMode?s("v-card-actions",[s("v-btn",{attrs:{color:"success",text:""},on:{click:e.action}},[e._v("Guardar")]),e._v(" "),s("v-btn",{attrs:{color:"error",text:""},on:{click:function(t){e.editingText="",e.editingMode=!1,e.selectedPermissions=[]}}},[e._v("Cancelar")])],1):e._e()],1):e._e()],1)],1),e._v(" "),s("v-dialog",{attrs:{"max-width":"640px",persistent:""},scopedSlots:e._u([{key:"activator",fn:function(e){e.on}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[e._v(" "),s("v-card",[s("v-card-title",{staticClass:"cyan white--text"},[s("span",{staticClass:"headline"},[e._v("Administración")])]),e._v(" "),s("v-card-text",[s("v-text-field",{attrs:{label:"Nombre"},model:{value:e.editado.name,callback:function(t){e.$set(e.editado,"name",t)},expression:"editado.name"}}),e._v(" "),s("v-text-field",{attrs:{label:"Correo Electrónico"},model:{value:e.editado.email,callback:function(t){e.$set(e.editado,"email",t)},expression:"editado.email"}}),e._v(" "),s("v-text-field",{attrs:{"append-icon":e.show?"mdi-eye":"mdi-eye-off",type:e.show?"text":"password",label:"Contraseña"},on:{"click:append":function(t){e.show=!e.show}},model:{value:e.editado.password,callback:function(t){e.$set(e.editado,"password",t)},expression:"editado.password"}})],1),e._v(" "),s("v-card-actions",[s("v-spacer"),e._v(" "),s("v-btn",{staticClass:"ma-2 white--text",attrs:{color:"blue-grey"},on:{click:e.cancelar}},[e._v("\n                  Cancelar\n              ")]),e._v(" "),s("v-btn",{staticClass:"ma-2 white--text",attrs:{color:"teal accent-4"},on:{click:e.guardar}},[e._v("\n                  Guardar\n              ")])],1)],1)],1),e._v(" "),s("v-dialog",{attrs:{"max-width":"640px"},scopedSlots:e._u([{key:"activator",fn:function(e){e.on}}]),model:{value:e.dialogNegocio,callback:function(t){e.dialogNegocio=t},expression:"dialogNegocio"}},[e._v(" "),s("v-card",[s("v-card-title",{staticClass:"cyan white--text"},[s("span",{staticClass:"headline"},[e._v("Administración")])]),e._v(" "),s("v-card-text",[s("v-checkbox",{attrs:{label:"Asignar negocio"},model:{value:e.editadoBusiness.checkB,callback:function(t){e.$set(e.editadoBusiness,"checkB",t)},expression:"editadoBusiness.checkB"}}),e._v(" "),s("v-select",{attrs:{items:e.stores,label:"Seleccione una tienda","single-line":"","item-text":"stor_name","item-value":"stor_pk","return-object":"","persistent-hint":""},model:{value:e.selectStore,callback:function(t){e.selectStore=t},expression:"selectStore"}})],1),e._v(" "),s("v-card-actions",[s("v-spacer"),e._v(" "),s("v-btn",{staticClass:"ma-2 white--text",attrs:{color:"blue-grey"},on:{click:e.cancelarNegocio}},[e._v("\n                  Cancelar\n              ")]),e._v(" "),s("v-btn",{staticClass:"ma-2 white--text",attrs:{color:"teal accent-4"},on:{click:e.guardarNegocio}},[e._v("\n                  Guardar\n              ")])],1)],1)],1)],1)}),[],!1,null,null,null);t.default=l.exports}}]);