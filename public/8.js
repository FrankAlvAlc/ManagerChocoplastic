(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{228:function(t,e,o){"use strict";o.r(e);var a={data:function(){return{map:{},drawingManager:{},stores:[],store:""}},created:function(){this.getCoverages()},mounted:function(){var t=document.createElement("script");t.setAttribute("src","https://maps.googleapis.com/maps/api/js?key=AIzaSyC4P8sBXqyMQpCqYbmnrV5WeHYgz9ukRSg&libraries=drawing,geometry&sensor=false"),document.head.appendChild(t)},methods:{getCoverages:function(){var t=this;axios.get("/coverages").then((function(e){t.stores=e.data.data})).catch((function(t){console.log(t)}))},initMap:function(){var t=this;this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:17.988073,lng:-92.940934},zoom:15}),this.drawingManager=new google.maps.drawing.DrawingManager({drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:["polygon"]}}),this.drawingManager.setMap(this.map),t.loadPolygons(this.map),google.maps.event.addListener(this.drawingManager,"polygoncomplete",(function(e){t.savePolygon(e),t.setPolygonEvents(e)}))},setPolygonEvents:function(t){var e=this;google.maps.event.addListener(t,"click",(function(t){console.log(this)})),google.maps.event.addListener(t,"rightclick",(function(o){null==o.vertex?confirm("Â¿Desea eliminar esta cobertura? Este cambio no se puede deshacer.")&&(this.setMap(null),e.destroyPolygon(t,this)):(t.getPath().removeAt(o.vertex),e.updatePolygon(t))})),google.maps.event.addListener(t.getPath(),"set_at",(function(o){e.updatePolygon(t)})),google.maps.event.addListener(t.getPath(),"insert_at",(function(){e.updatePolygon(t)}))},savePolygon:function(t){var e=this,o=this,a=google.maps.geometry.encoding.encodePath(t.getPath()),n=this.stores.find((function(t){return t.id==e.store}));axios.put("/coverages",{id:o.store,name:n.name,store_id:n.id,polygon:t.getPath().getArray().toString(),encode:a}).then((function(e){t.id=e.data.data.id,o.drawingManager.setDrawingMode(null)}))},updatePolygon:function(t){var e=google.maps.geometry.encoding.encodePath(t.getPath());axios.post("/coverages/"+t.id,{polygon:t.getPath().getArray().toString(),encode:e}).then((function(t){console.log("Poligono actualizado")}))},destroyPolygon:function(t,e){axios.get("/coverages/destroy/"+t.id).then((function(t){e.setMap(null)}))},loadPolygons:function(t){var e=this;axios.get("/coverages/"+this.store).then((function(t){if(!(t.data.data.length<=0)){var o=0;t.data.data.forEach((function(t){0==o?null!=t&&e.drawPolygonWithEvents(t):e.drawPolygon(t),o+=1}))}}))},drawPolygon:function(t){this.drawingManager.drawingControl=!0,this.drawingManager.polygonOptions={editable:!1,clickable:!1},this.drawingManager.setMap(this.map);var e=google.maps.geometry.encoding.decodePath(t.encode);new google.maps.Polygon({path:e,map:this.map,editable:!1,clickable:!1,strokeWeight:.6,strokeColor:"#002266",fillColor:"#002266"}).id=t.id},drawPolygonWithEvents:function(t){var e=google.maps.geometry.encoding.decodePath(t.encode),o=new google.maps.Polygon({path:e,map:this.map,editable:!0,strokeWeight:.8,strokeColor:"#992200",fillColor:"#e00"});o.id=t.id,this.map.setCenter(e[0]),this.setPolygonEvents(o)}}},n=o(3),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-container",[o("div",{staticClass:"container-fluid spark-screen"},[o("div",{staticClass:"row"},[o("div",{staticClass:"col-md-12 col-sm6"},[o("div",{staticClass:"box box-primary collapsed-box"},[o("div",{staticClass:"box-header with-border"},[o("h3",{staticClass:"box-title"},[t._v("Nueva cobertura de entrega")]),t._v(" "),o("div",{staticClass:"box-tools pull-right"},[o("button",{staticClass:"btn btn-box-tool",attrs:{type:"button","data-widget":"collapse","data-toggle":"tooltip",title:"Abrir"}},[o("i",{staticClass:"fa fa-plus"})])])]),t._v(" "),o("div",{staticClass:"box-body"},[o("div",{staticClass:"form-group"},[o("label",[t._v("Sucursal")]),t._v(" "),o("v-select",{attrs:{items:t.stores,"item-text":"name","item-value":"id",filled:"",chips:"",label:"Tienda",placeholder:"Selecciona sucursal"},on:{change:t.initMap},model:{value:t.store,callback:function(e){t.store=e},expression:"store"}})],1),t._v(" "),o("div",{staticStyle:{height:"500px"},attrs:{id:"map"}})])])])])])])}),[],!1,null,null,null);e.default=s.exports}}]);